# PDF 서식 자동 추출 도구 v6

## 개요
이 도구는 한국인터넷진흥원 규칙 PDF 파일에서 개별 서식들을 자동으로 감지하고 추출하여 의미있는 이름으로 별도의 PDF 파일로 저장하는 자동화 스크립트입니다.

## 기능
- PDF 파일에서 개별 서식 페이지를 자동 감지
- 각 서식의 실제 제목을 추출하여 의미있는 파일명 생성
- 개별 서식을 별도 PDF 파일로 분할 저장
- 서식 제목 패턴을 통한 정확한 서식 식별

## 설치된 패키지
```bash
pip install pdfplumber PyPDF2
```

## 사용법

### 전체 파일 처리
```bash
python pdf_form_extractor_v6.py
```

## 설정
- **입력 디렉토리**: `/app/documents/kisa_pdf`
- **출력 디렉토리**: `/app/documents/kisa_pdf/forms_extracted_v6`

## 감지 패턴

### 서식 시작 패턴
- `[별지 제X호 서식]`
- `[별표 X]`
- `[부록 X]`
- `[첨부서식 X]`
- `[첨부양식 X]`

### 서식 제목 패턴 (확장된 목록)
#### 신청/제출 관련
- 신청서, 제출서, 청구서, 요청서, 요구서, 사유서
- 취소신청서, 재발급신청서, 인증연장신청서

#### 보고/평가 관련
- 보고서, 평가서, 평가표, 점검표, 체크리스트
- 확인서, 요약서, 결과표, 검토서, 결과확인서, 완료확인서

#### 서약/계약 관련
- 서약서, 계약서, 협약서, 각서, 조서, 확약서
- 윤리서약서, 보안서약서, 직무윤리서약서

#### 승인/통지 관련
- 승인서, 통지서, 통보서, 발주서, 입찰서, 고지, 처분서

#### 등록/변경 관련
- 등록서, 변경서, 폐지서, 정지서, 회복서, 작업중지

#### 관리/운영 관련
- 관리서, 운영서, 처리서, 관리방침, 전결규정, 처리내역
- 관리대장, 출입관리대장

#### 대장/접수 관련
- 대장, 접수증, 접수대장, 위촉장, 일지, 점검일지
- 이력카드, 키관리대장, 문서관리대장

#### 인사 관련
- 자격기준, 지급기준, 전형단계, 사직원, 휴직원, 복직원
- 추천서, 인적사항, 추천사유, 심사, 성과평가표

#### 급여 관련
- 급여, 산정기준액, 수당, 명예퇴직금, 직무급, 자격수당지급신청서

#### 인증/시험 관련
- 인증서, 시험신청서, 시험계약서, 인증평가서, 성능평가서, 보안인증서

#### 동의/약관 관련
- 동의서, 이용약관, 개인정보수집이용동의서, 사후관리동의서

#### 현황/명세 관련
- 현황, 명세서, 내역서, 요약서, 프로파일

## 출력 파일명 형식
- `{원본파일명}_{추출된서식제목}.pdf`
- 예시: `3_16_전자서명인증관리업무규칙(210809)_공인인증기관실질심사_평가서.pdf`

## 처리 결과
- 총 121개 PDF 파일 처리 완료
- 추출된 서식 파일: 249개
- 서식이 발견된 파일: 약 40개
- 서식이 없는 파일: 약 81개

## 주요 특징
1. **정확한 제목 추출**: `[별지 제X호 서식]` 다음에 나오는 실제 서식 제목을 추출
2. **의미있는 파일명**: 서식의 실제 제목을 기반으로 한 직관적인 파일명 생성
3. **확장된 패턴 매칭**: 60여 개의 서식 제목 패턴으로 정확한 서식 식별
4. **개별 서식 분리**: 각 서식을 개별 PDF 파일로 분할하여 관리 용이성 향상
5. **상세한 로깅**: 처리 과정을 상세히 기록
6. **오류 처리**: 개별 파일 처리 실패 시에도 전체 프로세스 계속 진행

## 예시 출력
```
2025-09-05 12:02:43,044 - INFO - 처리 중: 4_34_클라우드컴퓨팅서비스 보안인증업무 지침(230403)
2025-09-05 12:02:43,044 - INFO -   저장됨: 4_34_클라우드컴퓨팅서비스 보안인증업무 지침(230403)_인증위원회_심의_결과_이의_신청서.pdf (페이지 23)
2025-09-05 12:02:43,044 - INFO -     제목: 인증위원회_심의_결과_이의_신청서
```

## 임베딩 통합 (v6 업데이트)

### Qdrant 벡터 데이터베이스 통합
추출된 서식들이 이제 `embed_documents.py`를 통해 Qdrant 벡터 데이터베이스에 임베딩되어 규정 본문과 함께 검색 가능합니다.

#### 통합 임베딩 특징
- **단일 컬렉션**: 규정 청크와 서식이 동일한 Qdrant 컬렉션에 저장
- **의미적 연결**: `doc_type` 필드로 구분 (`text`: 규정, `form`: 서식)
- **향상된 검색**: 서식별 토픽과 동의어를 통한 정확한 검색 지원
- **S3 연동**: 분리된 서식 PDF 파일의 S3 URI 연결

#### 서식 임베딩 메타데이터
```json
{
  "doc_type": "form",
  "form_title": "퇴직원_신청서",
  "form_page": 15,
  "form_file_uri": "s3://bucket/company_policy/파일명_퇴직원_신청서.pdf",
  "topics": ["퇴직", "사직", "퇴사", "퇴직서"],
  "synonyms": ["퇴직", "퇴사", "사직", "퇴직원"],
  "anchor_refs": ["doc_id#제12조"]
}
```

#### 검색 시나리오 예시
- **"퇴직 절차 알려줘"** → 규정 포인트와 연관 서식이 함께 노출
- **"퇴직서 서식 주세요"** → 서식 포인트가 상위 노출, S3 파일 링크 제공
- **"신청서 양식 찾아줘"** → 다양한 신청서 서식들이 토픽 매칭으로 검색

### S3 업로드 자동화
추출된 서식 파일들이 자동으로 S3 버킷의 `company_policy/` 디렉토리에 업로드됩니다.

#### 업로드 스크립트
```bash
python scripts/upload_forms_to_s3.py
```

#### S3 파일 구조
```
s3://bucket/company_policy/
├── 파일명_서식제목1.pdf
├── 파일명_서식제목2.pdf
└── ...
```

## 주의사항
- 서식이 없는 PDF 파일은 처리되지 않습니다
- 일부 PDF 파일은 텍스트 추출이 어려울 수 있습니다
- 대용량 파일 처리 시 시간이 오래 걸릴 수 있습니다
- 파일명은 50자로 제한됩니다
- 임베딩 전에 S3 업로드가 완료되어야 합니다

## 파일 구조
```
documents/kisa_pdf/
├── 원본 PDF 파일들...
└── forms_extracted_v6/
    ├── 파일명_서식제목1.pdf
    ├── 파일명_서식제목2.pdf
    └── ...

scripts/
└── upload_forms_to_s3.py  # S3 업로드 스크립트

# 임베딩 후 Qdrant 컬렉션
regulations_final/
├── 규정 청크 포인트들 (doc_type: "text")
└── 서식 포인트들 (doc_type: "form")
```
